parameters:
  - name: Environment
    default: dev
    values:
      - dev
      - test
  - name: APP
    default: applications
    values:
      - applications
      - appeals

variables:
  - name: APP
    value: ${{parameters.APP}}
  - name: ENV_GROUP_NAME
    value: e2e-${{parameters.Environment}}
  - group: ${{variables.ENV_GROUP_NAME}}

pr:
  branches:
    include:
      - main
  paths:
    include:
      - apps

jobs:
  - job: Run_Cypress_Tests
    pool:
      vmImage: "ubuntu-latest"

    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: "16.x"
        displayName: "Install Node.js"

      - task: Npm@1
        inputs:
          command: "install"
          workingDir: $(System.DefaultWorkingDirectory)/apps/e2e
        displayName: "Install Dependencies"

      - task: Npm@1
        inputs:
          command: "custom"
          customCommand: "run cy:run"
          workingDir: $(System.DefaultWorkingDirectory)/apps/e2e
        env:
          BASE_URL: ${{variables.ENV_GROUP_NAME}}.BASE_URL
          CASE_TEAM_EMAIL: ${{variables.ENV_GROUP_NAME}}.CASE_TEAM_EMAIL
          CASE_ADMIN_EMAIL: ${{variables.ENV_GROUP_NAME}}.CASE_ADMIN_EMAIL
          INSPECTOR_EMAIL: ${{variables.ENV_GROUP_NAME}}.INSPECTOR_EMAIL
          USER_PASSWORD: ${{variables.ENV_GROUP_NAME}}.USER_PASSWORD
        displayName: "Run Cypress Tests"
