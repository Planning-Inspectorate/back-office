@startuml
set separator none
title Function App - Background Jobs

left to right direction

!include <C4/C4>
!include <C4/C4_Context>
!include <C4/C4_Container>
!include <C4/C4_Component>

Container(CBOSCaseworkBackOfficeSystem.CBOSFilestorage, "CBOS File storage", $techn="", $descr="(application-service-uploads) - Azure Blob Storage Container that contains all documents and document versions in CBOS", $tags="", $link="")
Container(CBOSCaseworkBackOfficeSystem.PublishedFilestorage, "Published File storage", $techn="", $descr="(published-documents) - Azure Blob Storage Container that contains all Published documents, also accessible by Front Office", $tags="", $link="")
Container(CBOSCaseworkBackOfficeSystem.WebCBOSAPI, "Web CBOS API", $techn="Node.js, Azure Web App", $descr="CBOS API to perform CRUD operations on NSIP cases, documents, S51 Advice, Relevant Representations, Exam Timetables etc, on the database, and broadcast events to the Azure Service Bus", $tags="", $link="")
System(GOVNotify, "GOV Notify", $descr="UK government messaging platform for sending emails, text and letters to users", $tags="", $link="")

Container_Boundary("CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp_boundary", "Background Jobs Function App", $tags="") {
  Component(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.PublishDocument, "Publish Document", $techn="Function App, JavaScript", $descr="Publish a document to Front Office", $tags="", $link="")
  Component(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.UnpublishDocument, "Unpublish Document", $techn="Function App, JavaScript", $descr="Unpublish a document from Front Office", $tags="", $link="")
  Component(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.SendEmailtoSubscribers, "Send Email to Subscribers", $techn="Function App, JavaScript", $descr="Send an Email to Subscribers via Gov Notify", $tags="", $link="")
  Component(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.UpdatesdocumentMalwareScanStatus, "Updates document Malware Scan Status", $techn="Function App, JavaScript", $descr="Updates Malware status of documents to CBOS", $tags="", $link="")
}

Rel(CBOSCaseworkBackOfficeSystem.WebCBOSAPI, CBOSCaseworkBackOfficeSystem.CBOSFilestorage, "Reads and writes applications documents to", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.WebCBOSAPI, CBOSCaseworkBackOfficeSystem.PublishedFilestorage, "Writes published applications documents to", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.SendEmailtoSubscribers, GOVNotify, "Sends subscriber emails through", $techn="HTTPS, JSON", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.SendEmailtoSubscribers, CBOSCaseworkBackOfficeSystem.WebCBOSAPI, "Reads and updates subscription and project records", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.PublishDocument, CBOSCaseworkBackOfficeSystem.WebCBOSAPI, "Reads and updates applications documents records", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.PublishDocument, CBOSCaseworkBackOfficeSystem.CBOSFilestorage, "Reads applications documents from CBOS", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.PublishDocument, CBOSCaseworkBackOfficeSystem.PublishedFilestorage, "Copies published applications documents to", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.UnpublishDocument, CBOSCaseworkBackOfficeSystem.WebCBOSAPI, "Reads and updates applications documents records", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.UnpublishDocument, CBOSCaseworkBackOfficeSystem.PublishedFilestorage, "Deletes published applications documents from", $techn="", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.CBOSFilestorage, CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.UpdatesdocumentMalwareScanStatus, "MS Defender sends result of document malware scan", $techn="HTTPS, EventGrid", $tags="", $link="")
Rel(CBOSCaseworkBackOfficeSystem.BackgroundJobsFunctionApp.UpdatesdocumentMalwareScanStatus, CBOSCaseworkBackOfficeSystem.WebCBOSAPI, "Updates applications documents records malware check status", $techn="", $tags="", $link="")

SHOW_LEGEND(true)
@enduml