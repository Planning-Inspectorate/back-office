/**
 * @jest-environment jsdom
 */

// TODO: investigate why Jest PAI functions not defined
/* eslint-disable no-undef */
// @ts-nocheck
import initFilesListModule from '../files-list.module.js';
import { mockWindowLocation } from '../../../../../testing/app/mocks/client-side.js';

const DOM = `<form class="pins-files-list" method="post"><div class="govuk-grid-row display--flex"><div class="govuk-grid-column-two-thirds"><div class="pins-files-list__statuses"><p class="govuk-heading-s">Statuses</p><button class="govuk-button" data-module="govuk-button"> Apply changes</button></div></div><div class="govuk-grid-column-one-third"><div class="pins-files-list__actions"><p class="govuk-heading-s">Document actions</p></div></div></div><div class="pins-files-list__info govuk-body"><p class="govuk-heading-s">Select documents to make changes to statuses</p><div class="pagination-info"><p>This folder contains 123 document(s).Showing 1- 5document(s).</p><div><div class="govuk-form-group"> <label class="govuk-label" for="pageSize"> View </label> <select class="govuk-select" id="pageSize" name="pageSize"> <option value="25">25</option> <option value="50">50</option> <option value="75">75</option> <option value="100">100</option> <option value="125">125</option> </select></div></div></div><p><span id="selectedFilesNumber">0</span> document(s) selected</p></div><table class="govuk-table pins-files-list__table pins-table"><thead class="govuk-table__head govuk-body-s"><tr class="govuk-table__row"><th scope="col" class="govuk-table__header">Select</th><th scope="col" class="govuk-table__header">Document information</th><th scope="col" class="govuk-table__header">Date received</th><th scope="col" class="govuk-table__header">Redaction</th><th scope="col" class="govuk-table__header">Status</th><th scope="col" class="govuk-table__header">Actions</th></tr></thead><tbody class="govuk-table__body govuk-body-s"><tr class="govuk-table__row"><td class="govuk-table__cell"><div class="govuk-form-group"> <div class="govuk-checkboxes" data-module="govuk-checkboxes"> <div class="govuk-checkboxes__item"> <input class="govuk-checkboxes__input" id="selectAll" name="selectAll" type="checkbox" value="true"> <label class="govuk-label govuk-checkboxes__label" for="selectAll"> Select all </label> </div></div></div></td><td class="govuk-table__cell" colspan="5"><p>Select all documents on page</p></td></tr><tr class="govuk-table__row"><td class="govuk-table__cell"><div class="govuk-form-group"> <div class="govuk-checkboxes" data-module="govuk-checkboxes"> <div class="govuk-checkboxes__item"> <input class="govuk-checkboxes__input" id="selectedFilesIds" name="selectedFilesIds" type="checkbox" value="0"> <label class="govuk-label govuk-checkboxes__label" for="selectedFilesIds"> 1 Ut enim ad minim veniam </label> </div></div></div></td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s govuk-!-font-weight-bold" href="url/to/file/0">1 Ut enim ad minim veniam</a><p class="file-info colour--secondary">From: Ut Aliqua</p><p class="file-info colour--secondary">File type and size: JPG,6.6 MB</p></td><td class="govuk-table__cell">05/01/2181</td><td class="govuk-table__cell">Redacted</td><td class="govuk-table__cell">Checked</td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s" href="url/to/file/0/edit">View/Editproperties</a><a class="govuk-link govuk-body-s" href="url/to/file/0">Download</a></td></tr><tr class="govuk-table__row"><td class="govuk-table__cell"><div class="govuk-form-group"> <div class="govuk-checkboxes" data-module="govuk-checkboxes"> <div class="govuk-checkboxes__item"> <input class="govuk-checkboxes__input" id="selectedFilesIds" name="selectedFilesIds" type="checkbox" value="1"> <label class="govuk-label govuk-checkboxes__label" for="selectedFilesIds"> 2 Minim veniam quis nostrud exercitation </label> </div></div></div></td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s govuk-!-font-weight-bold" href="url/to/file/1">2 Minim veniam quis nostrud exercitation</a><p class="file-info colour--secondary">From: Minim Enim</p><p class="file-info colour--secondary">File type and size: MP3,7.6 MB</p></td><td class="govuk-table__cell">14/09/2212</td><td class="govuk-table__cell">Redacted</td><td class="govuk-table__cell">Checked</td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s" href="url/to/file/1/edit">View/Editproperties</a><a class="govuk-link govuk-body-s" href="url/to/file/1">Download</a></td></tr><tr class="govuk-table__row"><td class="govuk-table__cell"><div class="govuk-form-group"> <div class="govuk-checkboxes" data-module="govuk-checkboxes"> <div class="govuk-checkboxes__item"> <input class="govuk-checkboxes__input" id="selectedFilesIds" name="selectedFilesIds" type="checkbox" value="2"> <label class="govuk-label govuk-checkboxes__label" for="selectedFilesIds"> 3 Nostrud exercitation ullamco laboris nisi ut </label> </div></div></div></td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s govuk-!-font-weight-bold" href="url/to/file/2">3 Nostrud exercitation ullamco laboris nisi ut</a><p class="file-info colour--secondary">From: Nostrud Minim</p><p class="file-info colour--secondary">File type and size: MP3,8.6 MB</p></td><td class="govuk-table__cell">23/05/2244</td><td class="govuk-table__cell">Redacted</td><td class="govuk-table__cell">Checked</td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s" href="url/to/file/2/edit">View/Editproperties</a><a class="govuk-link govuk-body-s" href="url/to/file/2">Download</a></td></tr><tr class="govuk-table__row"><td class="govuk-table__cell"><div class="govuk-form-group"> <div class="govuk-checkboxes" data-module="govuk-checkboxes"> <div class="govuk-checkboxes__item"> <input class="govuk-checkboxes__input" id="selectedFilesIds" name="selectedFilesIds" type="checkbox" value="3"> <label class="govuk-label govuk-checkboxes__label" for="selectedFilesIds"> 4 Laboris nisi ut aliquip ex ea </label> </div></div></div></td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s govuk-!-font-weight-bold" href="url/to/file/3">4 Laboris nisi ut aliquip ex ea</a><p class="file-info colour--secondary">From: Laboris Quis</p><p class="file-info colour--secondary">File type and size: MP3,9.6 MB</p></td><td class="govuk-table__cell">30/01/2276</td><td class="govuk-table__cell">Redacted</td><td class="govuk-table__cell">Checked</td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s" href="url/to/file/3/edit">View/Editproperties</a><a class="govuk-link govuk-body-s" href="url/to/file/3">Download</a></td></tr><tr class="govuk-table__row"><td class="govuk-table__cell"><div class="govuk-form-group"> <div class="govuk-checkboxes" data-module="govuk-checkboxes"> <div class="govuk-checkboxes__item"> <input class="govuk-checkboxes__input" id="selectedFilesIds" name="selectedFilesIds" type="checkbox" value="4"> <label class="govuk-label govuk-checkboxes__label" for="selectedFilesIds"> 5 Dolor sit </label> </div></div></div></td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s govuk-!-font-weight-bold" href="url/to/file/4">5 Dolor sit</a><p class="file-info colour--secondary">From: Dolor Adipiscing</p><p class="file-info colour--secondary">File type and size: DOC,0.7 MB</p></td><td class="govuk-table__cell">19/01/1994</td><td class="govuk-table__cell">Unredacted</td><td class="govuk-table__cell">Not checked</td><td class="govuk-table__cell"><a class="govuk-link govuk-body-s" href="url/to/file/4/edit">View/Editproperties</a><a class="govuk-link govuk-body-s" href="url/to/file/4">Download</a></td></tr></tbody></table><nav class="govuk-pagination" role="navigation" aria-label="results"><ul class="govuk-pagination__list"><li class="govuk-pagination__item govuk-pagination__item--current"> <a class="govuk-link govuk-pagination__link" href="?number=1&amp;size=5" aria-label="Page 1" aria-current="page"> 1 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=2&amp;size=5" aria-label="Page 2"> 2 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=3&amp;size=5" aria-label="Page 3"> 3 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=4&amp;size=5" aria-label="Page 4"> 4 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=5&amp;size=5" aria-label="Page 5"> 5 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=6&amp;size=5" aria-label="Page 6"> 6 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=7&amp;size=5" aria-label="Page 7"> 7 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=8&amp;size=5" aria-label="Page 8"> 8 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=9&amp;size=5" aria-label="Page 9"> 9 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=10&amp;size=5" aria-label="Page 10"> 10 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=11&amp;size=5" aria-label="Page 11"> 11 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=12&amp;size=5" aria-label="Page 12"> 12 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=13&amp;size=5" aria-label="Page 13"> 13 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=14&amp;size=5" aria-label="Page 14"> 14 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=15&amp;size=5" aria-label="Page 15"> 15 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=16&amp;size=5" aria-label="Page 16"> 16 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=17&amp;size=5" aria-label="Page 17"> 17 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=18&amp;size=5" aria-label="Page 18"> 18 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=19&amp;size=5" aria-label="Page 19"> 19 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=20&amp;size=5" aria-label="Page 20"> 20 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=21&amp;size=5" aria-label="Page 21"> 21 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=22&amp;size=5" aria-label="Page 22"> 22 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=23&amp;size=5" aria-label="Page 23"> 23 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=24&amp;size=5" aria-label="Page 24"> 24 </a> </li><li class="govuk-pagination__item"> <a class="govuk-link govuk-pagination__link" href="?number=25&amp;size=5" aria-label="Page 25"> 25 </a> </li></ul><div class="govuk-pagination__next"> <a class="govuk-link govuk-pagination__link" href="?number=2&amp;size=5" rel="next"> <span class="govuk-pagination__link-title">Next</span> <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13"> <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path> </svg></a> </div></nav></form>`;

document.body.innerHTML = DOM;

initFilesListModule();

describe('Files list', () => {
	describe('Toggle all checkbox', () => {
		const selectAllCheckBox = document.querySelector('input[name="selectAll"]');
		const selectedFilesNumber = document.querySelector('#selectedFilesNumber');

		it('should select all when checked', async () => {
			selectAllCheckBox.checked = false;
			await selectAllCheckBox.click();

			const checkedFiles = document.querySelectorAll('input[name="selectedFilesIds"]:checked');

			expect(checkedFiles.length).toBe(5);
			expect(selectedFilesNumber.textContent).toBe('5');
		});

		it('should unselect all when unchecked', async () => {
			selectAllCheckBox.checked = true;
			await selectAllCheckBox.click();

			const checkedFiles = document.querySelectorAll('input[name="selectedFilesIds"]:checked');

			expect(checkedFiles.length).toBe(0);
			expect(selectedFilesNumber.textContent).toBe('0');
		});
	});

	describe('Pagination dropdown', () => {
		let windowLocation;

		beforeEach(() => {
			windowLocation = window.location;
			mockWindowLocation();
		});

		afterEach(() => {
			window.location = windowLocation;
		});

		it('Should refresh the page with the right pageSize', () => {
			const pageSizeSelect = document.querySelector('select[name="pageSize"]');

			pageSizeSelect.value = 50;
			pageSizeSelect.dispatchEvent(new Event('change'));

			expect(window.location.assign).toBeCalledWith('.?number=1&size=50');
		});
	});
});
