{% extends "app/layouts/app-two-column.layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/file-upload/macro.njk" import govukFileUpload %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "app/components/document-list.component.njk" import documentList %}
{% from "app/components/document-upload-info.njk" import documentUploadInfo %}

{% set isUniqueDocument = documentType !== 'supporting document' %}
{% set documentLimit = 1 if isUniqueDocument else Infinity %}
{% set documentsForType = documents | filter({ Type: documentType }) %}

{% set pageTitle = 'Change ' + documentType | pluralize(documentLimit) %}
{% set backLinkUrl = '/validation/appeals/' + appealId %}

{% block pageHeading %}
	<h1 class="govuk-heading-l">{{ pageTitle }}</h1>
{% endblock %}

{% block pageContent %}
  {% if documentsForType.length > 0 %}
    {{
      govukSummaryList({
        rows: [ 
          { 
            key: { text: 'Current file' | pluralize(documentLimit) },
            value: { html: documentList(documentsForType) }
          }
        ]
      })
    }}
  {% endif %}

  <form method="post" enctype="multipart/form-data" novalidate="novalidate">
    {% if isUniqueDocument %}
      {{
        govukFileUpload({
          id: "files",
          name: "files",
          label: {
            text: "Upload a new file",
            classes: "govuk-label--m"
          },
          errorMessage: errors.files | errorMessage,
          hint: {
            text: 'The uploaded file will replace the existing ' + documentType + '.'
          },
          attributes: {
            accept: documentMimeTypes
          }
        })
      }}
    {% else %}
      {{ 
        govukFileUpload({
          id: "files",
          name: "files",
          label: {
            text: "Upload files",
            classes: "govuk-label--m"
          },
          errorMessage: errors.files | errorMessage,
          hint: { 
            html: 'Drag and drop files or select "choose files".<br>The uploaded files will be added to the list of current ' + documentType | pluralize(documentLimit) + '.'
          },
          attributes: {
            accept: documentMimeTypes,
            multiple: "multiple"
          }
        })
      }}
    {% endif %}
    {{ documentUploadInfo() }}
    <div class="govuk-button-group">
      {{ govukButton({ text: "Save changes" }) }}
      <a class="govuk-link" href="/validation/appeals/{{ appealId }}">Cancel</a>
    </div>
  </form>

{% endblock %}
