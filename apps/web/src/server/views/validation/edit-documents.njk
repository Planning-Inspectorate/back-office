{% extends "app/layouts/app-two-column.layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/file-upload/macro.njk" import govukFileUpload %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "app/components/document-list.component.njk" import documentList %}

{% set isUniqueDocument = documentType !== 'supporting document' %}
{% set documentLimit = 1 if isUniqueDocument else Infinity %}
{% set documentsForType = documents | filter({ Type: documentType }) %}
{% set acceptMimeTypes = [
  'application/msword',
  'application/pdf',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
  'image/jpeg',
  'image/png',
  'image/tiff'
] %}

{% set pageTitle = 'Change ' + documentType | pluralize(documentLimit) %}
{% set backLinkUrl = '/validation/appeals/' + appealId %}

{% block pageHeading %}
	<h1 class="govuk-heading-l">{{ pageTitle }}</h1>
{% endblock %}

{% block pageContent %}
  {% if documentsForType.length > 0 %}
    {{
      govukSummaryList({
        rows: [ 
          { 
            key: { text: 'Current file' | pluralize(documentLimit) },
            value: { html: documentList(documentsForType) }
          }
        ]
      })
    }}
  {% endif %}

  <form method="post" enctype="multipart/form-data" novalidate="novalidate">
    {% if isUniqueDocument %}
      {{
        govukFileUpload({
          id: "files",
          name: "files",
          label: {
            text: "Upload a new file",
            classes: "govuk-label--m"
          },
          errorMessage: errors.files and errors.files.msg,
          hint: {
            text: 'The uploaded file will replace the existing ' + documentType + '.'
          },
          attributes: {
            accept: acceptMimeTypes
          }
        })
      }}
    {% else %}
      {{ 
        govukFileUpload({
          id: "files",
          name: "files",
          label: {
            text: "Upload files",
            classes: "govuk-label--m"
          },
          errorMessage: errors.files and { text: errors.files.msg },
          hint: { 
            html: 'Drag and drop files or select "choose files".<br>The uploaded files will be added to the list of current ' + documentType | pluralize(documentLimit) + '.'
          },
          attributes: {
            accept: acceptMimeTypes,
            multiple: "multiple"
          }
        })
      }}
    {% endif %}
    {{ 
      govukInsetText({
        text: "File size should be no more than 15MB"
      })
    }}
    {{
      govukDetails({
        summaryText: 'Help with file formats',
        html: fileFormatDetails()
      })
    }}
      <div class="govuk-button-group">
        {{ govukButton({ text: "Save changes" }) }}
        <a class="govuk-link" href="/validation/appeals/{{ appealId }}">Cancel</a>
      </div>
    </form>

  {% endblock %}

  {% macro fileFormatDetails() %}
    <p class="govuk-body">Your file must be in one of the following formats:</p>
    <ul class="govuk-list govuk-list--bullet">
      {% for extname in[
        'pdf',
        'doc',
        'docx',
        'tif',
        'tiff',
        'jpg',
        'jpeg',
        'png'
      ] %}
        <li>{{ extname }}</li>
      {% endfor %}
    </li>
  {% endmacro %}