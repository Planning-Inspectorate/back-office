{% extends "app/layouts/app.layout.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "app/components/info-box.njk" import infoBox %}

{% set pageTitle = 'Appeal submissions for review' %}
{% set newAppeals = appeals | filter({ AppealStatus: 'new' }) %}
{% set incompleteAppeals = appeals | filter ({ AppealStatus: 'incomplete' }) %}

{% block pageContent %}
	{% if newAppeals.length > 0 %}
		{{
			appealTable({ 
				appeals: newAppeals,
				caption: 'New appeals'
			}) 	
		}}
	{% else %}
		<h2 class="govuk-heading-l govuk-!-margin-bottom-3">New appeals</h2>
		{{
			infoBox({
				text: "No new appeals",
				classes: "govuk-!-margin-bottom-8"
			})
		}}
	{% endif %}

	{% if incompleteAppeals.length > 0 %}
		{{
			appealTable({
				appeals: incompleteAppeals,
				caption: 'Incomplete appeals'
			})
		}}
	{% else %}
		<h2 class="govuk-heading-l govuk-!-margin-bottom-3">Incomplete appeals</h2>
		{{ infoBox({ text: "No incomplete appeals" }) }}
	{% endif %}
{% endblock %}

{% macro appealTable(params) %}
	{% macro createReferenceCell(appeal) %}
		<a class="govuk-link" href="/validation/appeals/{{appeal.AppealId}}">
			{{ appeal.AppealReference }}
		</a>
	{% endmacro %}

	{% set rows = [] %}
	{% for appeal in params.appeals %}
		{% set row = [
			{ html: createReferenceCell(appeal) },
			{ text: appeal.Received },
			{ text: appeal.AppealSite | collapse(', ') }
		] %}
		{% set rows = rows | concat([row]) %}
	{% endfor %}

  {{
    govukTable({
			caption: params.caption,
			captionClasses: "govuk-table__caption--l",
			classes: 'pins-table--fixed',
      head: [
      	{ text: "Appeal reference", classes: "pins-table__cell--l" },
        { text: "Received on", classes: "pins-table__cell--s" },
        { text: "Appeal site" }
      ],
			rows: rows
    })
  }}
{% endmacro %}
