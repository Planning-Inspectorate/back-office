{% extends "../case/layouts/applications-case-layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}

{% set pageTitle = 'Project team' %}

{% block sectionContent %}

	{% if showSuccessBanner %}
		{% set html %}
			<h3 class="govuk-notification-banner__heading">
				Team member removed
			</h3>
		{% endset %}

		{{
			govukNotificationBanner({
				html: html,
				type: 'success'
			})
		}}
	{% endif %}

	<h3 class="govuk-heading-m">{{pageTitle}}</h3>

	<p class="govuk-body">Add team members and their roles to the project. </p>

	{% if projectTeamMembers.length > 0 %}
		{% set teamMembersRows = [] %}

		{% for teamMember in projectTeamMembers %}

			{% set teamMemberRole = '' %}
			{% for role in allRoles %}
				{% if role.value === teamMember.role %}
					{% set teamMemberRole = role.text %}
				{% endif %}
			{% endfor %}

			{% if teamMember.givenName and teamMember.surname and teamMember.userPrincipalName %}
				{% set teamMemberRolePageUrl %}
					<a class='govuk-link govuk-!-margin-right-3' href='{{'project-team-member'|url({
						caseId: caseId,
						userId: teamMember.id or teamMember.userId,
						step: 'choose-role'
						})}}'>Change role<span class="govuk-visually-hidden">for {{ teamMember.givenName }} {{ teamMember.surname }}</span>
					</a>
				{% endset %}
				{% set displayGivenName = teamMember.givenName %}
				{% set displaySurname = teamMember.surname %}
			{% else %}
				{% set teamMemberRolePageUrl %}{% endset %}
			{% endif %}

			{% set teamMemberDeletePageUrl %}
				<a class='govuk-link' href='{{'project-team-member'|url({
					caseId: caseId,
					userId: teamMember.id or teamMember.userId,
					step: 'remove'
					})}}'>Remove<span class="govuk-visually-hidden">{{ displayGivenName }} {{ displaySurname }}</span>
				</a>
			{% endset %}

			{%
				set row = [
					{
						html: '<strong>' + teamMemberRole + '</strong>'
					}, {
						text: (displayGivenName + ' ' + displaySurname)
					}, {
						html: (teamMemberRolePageUrl + teamMemberDeletePageUrl)
					}
				]
			%}

			{% set teamMembersRows = teamMembersRows.concat([row]) %}

		{% endfor %}

		{{
			govukTable({
				classes: 'stretch-last-column',
				head: [
					{ text: "Role" },
					{ text: "Team Member" },
					{ text: "Actions" }
				],
				rows: teamMembersRows
			})
		}}

	{% endif %}

	<a class='govuk-button govuk-!-margin-top-6' href='{{'project-team'|url({caseId: caseId, step: 'search'})}}'>
		Add team member
	</a>

{% endblock %}
