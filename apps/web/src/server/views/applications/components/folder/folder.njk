{% extends "../../case/layouts/applications-case-layout.njk" %}

{% from "./folder-header.component.njk" import folderHeader %}
{% from "./folder-status.component.njk" import folderStatus %}
{% from "./folder-actions.component.njk" import folderActions %}
{% from "../../case-documentation/documentation-table.njk" import folderDocumentsTable %}
{% from "../../case-s51/s51-table.njk" import folderS51Table %}

{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/pagination/macro.njk" import govukPagination %}
{% from "govuk/components/tag/macro.njk" import govukTag %}

{% set isS51folder = currentFolder.displayNameEn === 'S51 advice' %}

{% block errorSummary %}
	{% if errors %}
		<div class="govuk-grid-row">
			<div class="govuk-grid-column-full">
				{{
					govukErrorSummary({
						titleText: "There is a problem",
						errorList: errors | mapToErrorSummary
					})
				}}
			</div>
		</div>
	{% endif %}
{% endblock %}

{% block beforeContent %}{% endblock %}

{% block pageContent %}

	{% set userIsInspector = domainType === 'inspector' %}

	<div class="govuk-grid-row">
		<div class="govuk-grid-column-full">
			{% block sectionContent %}
				{{ govukBreadcrumbs({
					classes: 'govuk-!-margin-top-0',
					items: breadcrumbItems
				}) }}

				{{ folderHeader(currentFolder, subFolders, caseId, isS51folder) }}

				{{ folderStatus(currentFolder, items, caseId, userIsInspector, isS51folder) }}

				{% if not userIsInspector %}
					{% if items.itemCount %}
						<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
						{% if isS51folder %}
							<form class="pins-files-list" method="post" action="{{'s51-status'|url({caseId: caseId, folderId: folderId}) }}">
						{% else %}
							<form class="pins-files-list" method="post">
						{% endif %}
							<caption>
								<span class="display--sr-only">Manage Documents in this location</span>
							</caption>

							{{ folderActions(isS51folder) }}

							{% if isS51folder %}
								{{ folderS51Table(items, pagination, caseId, folderId) }}
							{% else %}
								{{ folderDocumentsTable(items, pagination, caseId, folderId) }}
							{% endif %}

							{{ govukPagination(pagination.buttons) }}
						</form>
					{% endif %}
				{% endif %}
			{% endblock %}
		</div>
	</div>
{% endblock %}
