{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}

{% macro caseApplicantTable(case, isPublishPage, sectionTitle, editLink, editText) %}
    {% set applicantFirstOrganisationName = case.applicant.organisationName %}
    {% set applicantFirstEmail = case.applicant.email %}
    {% set applicantFirstPhoneNumber = case.applicant.phoneNumber %}
    {% set applicantFirstWebsite = case.applicant.website %}
    {% set applicantFirstWebsiteValue = '' %}

    {% if applicantFirstWebsite %}
      {% set applicantFirstWebsiteValue = '<a class="govuk-link" href="' + applicantFirstWebsite + '">' + applicantFirstWebsite + '</a>' %}
    {% endif %}

    {% set rowsData = [
      {title: 'Organisation name', text: applicantFirstOrganisationName, url: 'applicant-organisation-name' },
      {title: 'Contact name (Internal use only)', text: writeFullName([case.applicant.firstName, case.applicant.middleName, case.applicant.lastName] ), url: 'applicant-full-name', isProjectInfoOnly: 1 },
      {title: 'Address (Internal use only)', text: case.applicant.address | formatAddress, url: 'applicant-address', isProjectInfoOnly: 1 },
      {title: 'Website', html: applicantFirstWebsiteValue, url: 'applicant-website' },
      {title: 'Email address (Internal use only)', text: applicantFirstEmail, url: 'applicant-email', isProjectInfoOnly: 1 },
      {title: 'Telephone number (Internal use only)', text: applicantFirstPhoneNumber, url: 'applicant-telephone-number', isProjectInfoOnly: 1 }
    ] %}

    {% set tableRows = [] %}
    {% for rowData in rowsData %}
        {% if not rowData.isProjectInfoOnly or (rowData.isProjectInfoOnly and not isPublishPage) %}
            {% set row = {
              key: {
                text: rowData.title
              },
              value: rowData,
              actions: {
                items: [
                  {
                    href: 'case-edit' | url({ caseId: case.id, step: rowData.url }),
                    text: 'Change',
                    id: rowData.id
                  }
                ] if not isPublishPage else []
              }
            } %}
            {% set tableRows = (tableRows.push(row), tableRows) %}
        {% endif %}
    {% endfor %}

    {% if isPublishPage %}
      {{ govukSummaryList({
        card: {
          title: {
            text: sectionTitle
          },
          actions: {
            items: [
              {
                href: editLink,
                text: editText,
                visuallyHiddenText: sectionTitle
              }
            ]
          }
        },
        rows: tableRows
      }) }}
    {% else %}
      {{ govukSummaryList({
        caption: 'Applicant details',
        captionClasses: 'govuk-visually-hidden',
        firstCellIsHeader: true,
        rows: tableRows
      }) }}
    {% endif %}
{% endmacro %}

{% macro writeFullName(params) %}
    {% set spacer = joiner(' ') %}
    {% for namePart in params -%}
        {{ spacer() }}{{ namePart }}
    {%- endfor %}
{% endmacro %}
