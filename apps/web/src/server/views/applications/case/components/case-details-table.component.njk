{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "./case-edit-link.component.njk" import caseEditLink %}

{% macro caseDetailsTable(params, isPublishPage, isWelsh) %}
	{% set regionNames = [] %}
	{% for item in params.case.geographicalInformation.regions %}
		{% set regionNames = (regionNames.push(item.displayNameEn), regionNames) %}
	{% endfor %}

	{% set gridReferences = '' %}
	{% if params.case.geographicalInformation.gridReference.easting %}
		{% set gridReferences = params.case.geographicalInformation.gridReference.easting + ' (Easting)' %}
	{% endif %}
	{% set gridReferences = gridReferences + '<br>' %}
	{% if params.case.geographicalInformation.gridReference.northing %}
		{% set gridReferences = gridReferences + params.case.geographicalInformation.gridReference.northing + ' (Northing)' %}
	{% endif %}

  {% set rowsData = buildCaseInformation({
    case: params.case,
    keyMembers: params.keyMembers,
    gridReferences: gridReferences,
    regionNames: regionNames
  }, isWelsh) %}

	{% set tableRows = [] %}
	{% for rowData in rowsData %}
		{#  In the value column, rowData can be used because "title" and "url" are ignored	#}
		{% set cols = [{text: rowData.title}, rowData] %}

    {% if not isPublishPage %}
      {% set linkCol = {
        html: caseEditLink({editStepUrl:rowData.url, caseId: params.case.id}),
        classes: 'text-align--right pins-table__cell--s'
      } if rowData.url else '&nbsp;' %}

      {% set cols = (cols.push(linkCol), cols) %}
    {% endif %}

		{% set tableRows = (tableRows.push(cols), tableRows) %}
	{% endfor %}


	{{ govukTable({
		caption: 'Project details',
		captionClasses: 'govuk-visually-hidden',
		firstCellIsHeader: true,
		classes: 'project-details',
		rows: tableRows
	}) }}
{% endmacro %}
