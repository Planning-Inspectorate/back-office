{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "./case-edit-link.component.njk" import caseEditLink %}

{% macro caseDetailsTable(case, isPublishPage) %}
	{% set regionNames = [] %}
	{% for item in case.geographicalInformation.regions %}
		{% set regionNames = (regionNames.push(item.displayNameEn), regionNames) %}
	{% endfor %}

	{% set gridReferences = '' %}
	{% if case.geographicalInformation.gridReference.easting %}
		{% set gridReferences = case.geographicalInformation.gridReference.easting + ' (Easting)' %}
	{% endif %}
	{% set gridReferences = gridReferences + '<br>' %}
	{% if case.geographicalInformation.gridReference.northing %}
		{% set gridReferences = gridReferences + case.geographicalInformation.gridReference.northing + ' (Northing)' %}
	{% endif %}

	{% set rowsData = [
		{title: 'Project name', text: case.title, url: 'name' },
		{title: 'Project description', html: case.description | sanitize, url: 'description' },
		{title: 'Project email address', text: case.caseEmail, url: 'team-email' },
		{title: 'Project location', html: case.geographicalInformation.locationDescription | sanitize, url: 'project-location' },
		{title: 'Grid references', html: gridReferences, url: 'grid-references' },
		{title: 'Region(s)', html: regionNames, url: 'regions' },
		{title: 'Map zoom level', text: case.geographicalInformation.mapZoomLevel.displayNameEn, url: 'zoom-level' }
	] %}

	{% set tableRows = [] %}
	{% for rowData in rowsData %}
		{#  In the value column, rowData can be used because "title" and "url" are ignored	#}
		{% set cols = [{text: rowData.title}, rowData] %}
		{% set linkCol =  {
			html: caseEditLink({editStepUrl:rowData.url, caseId: case.id}),
			classes: 'text-align--right pins-table__cell--s'
		} %}
		{% if not isPublishPage %}
			{% set cols = (cols.push(linkCol), cols) %}
		{% endif %}

		{% set tableRows = (tableRows.push(cols), tableRows) %}
	{% endfor %}


	{{ govukTable({
		firstCellIsHeader: true,
		rows: tableRows
	}) }}
{% endmacro %}
