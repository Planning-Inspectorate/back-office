{% extends "../../layouts/applications.layout.njk" %}

{% from "../components/case-page-navigation.component.njk" import casePageNavigation %}
{% from "govuk/components/accordion/macro.njk" import govukAccordion %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "../../components/status-tag.component.njk" import statusTag %}


{% set pageTitle = case.title %}

{% set isPageWithRepublishBanner = selectedPageType === 'overview' or selectedPageType === 'project-information' or selectedPageType === 'key-dates' %}

{% block beforeContent %}
<aside>
	{{ govukBackLink({
		text: "Back to applications",
		href: 'dashboard'|url
	}) }}
</aside>
{% endblock %}

{% block pageHeading %}
	<div class="top-errors-hook" role="alert"></div>
	<div class="govuk-grid-row govuk-!-padding-top-9 govuk-!-padding-bottom-2 govuk-!-margin-left-0 govuk-!-margin-bottom-7 pins-masthead-summary">
	<div class="govuk-grid-column-full">
		<h4 class="govuk-heading-m"> {{ case.reference }} </h4>
		<h1 class="govuk-heading-xl">
		{% if pageCaption %}
			<span class="govuk-caption-xl">{{ pageCaption }}</span>
		{% endif %}{{ pageHeading or pageTitle }}
		</h1>

		{% block pageHeadingData %}
			<div class="govuk-grid-row">
				<div class="govuk-grid-column-full govuk-body">
					{{ case.sector.displayNameEn }}, {{ case.subSector.displayNameEn }}
					<br><br>
					{{ statusTag(case.status) }}
				</div>
			</div>
		{% endblock %}
	</div>
	</div>
{% endblock %}

{% block pageContent %}
	<div class="govuk-grid-row display--flex">
		{% block sectionMenu %}
			<div class="pins-list-menu-container">
				{{ casePageNavigation({ case: case, selectedPageType: selectedPageType }) }}
			</div>
		{% endblock %}
		<div class="govuk-grid-column-full">

	{% if isPageWithRepublishBanner and case.hasUnpublishedChanges and case.publishedDate %}
        {% set unpublishedBannerHtml %}
          <h4 class="govuk-notification-banner__heading">Unpublished changes have been made.</h4>
          <p class="govuk-body">
            <a href="{{ 'case-view' | url({caseId:case.id, step: 'preview-and-publish'}) }}">Preview and publish</a> the project for changes to be applied.
          </p>
        {% endset %}

        {{ govukNotificationBanner({
          html: unpublishedBannerHtml
        }) }}
      {% endif %}

			{% block sectionContent %}
			{% endblock %}
		</div>
	</div>
{% endblock %}

