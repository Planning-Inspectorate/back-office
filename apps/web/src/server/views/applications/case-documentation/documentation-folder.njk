{% extends "../case/layouts/applications-case-layout.njk" %}

{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/pagination/macro.njk" import govukPagination %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/accordion/macro.njk" import govukAccordion %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}


{% block beforeContent %}{% endblock %}

{% block pageContent %}
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-full">
			{% block sectionContent %}
				{{ govukBreadcrumbs({
					classes: 'govuk-!-margin-top-0',
					items: breadcrumbItems
				}) }}

				<div class="pins-dashboard-list--hide-controls">
					<h2 class="govuk-heading-l">{{ currentFolder.displayNameEn }} folder</h2>

					{% set folderRows = [] %}
					{% for subFolder in subFolders %}
						{% set folderRows = folderRows | concat ([[
							{ html: '<a class="govuk-link govuk-body-m" href="' + 'document-category' |url({caseId: caseId, documentationCategory: subFolder}) +'">' + subFolder.displayNameEn + '</a>' }
						]]) %}
					{% endfor %}

					{{ govukAccordion({
						items: [{
							content: {
								html: govukTable({
									rows: folderRows
								})
							}
						}]
					}) }}
				</div>

				{% set userIsInspector = domainType === 'inspector' %}
				{% set userIsCaseAdminOfficer = domainType === 'case-admin-officer' %}

				<div class="govuk-grid-row govuk-!-margin-top-0">
					<div class="govuk-grid-column-one-half govuk-!-margin-top-0">
						<h4 class="govuk-heading-m">Documents</h4>
						<p class="govuk-body">This folder contains {{ documentationFiles.itemCount }} document(s).</p>
						{% if not userIsInspector %}
							<a class="govuk-button govuk-button--secondary govuk-!-margin-0"
							   href="{{ 'document-category'|url({caseId: caseId, documentationCategory: currentFolder, step: 'upload'}) }}">
								Upload files
							</a>
						{% endif %}
					</div>
				</div>

				{% if  userIsCaseAdminOfficer %}
					<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
					{% if documentationFiles |length %}
						<form class="pins-files-list" method="post">
							<div class="govuk-grid-row display--flex">
								<div class="govuk-grid-column-two-thirds">
									<div class="pins-files-list__statuses">
										<p class="govuk-heading-s">Statuses</p>
										<div class="govuk-grid-row">
											<div>{{ govukRadios({
													name: "isRedacted",
													fieldset: {
														legend: {
															text: "Redaction"
														}
													},
													items: [
														{
															value: 0,
															text: "Unredacted"
														},
														{
															value: 1,
															text: "Redacted"
														}
													]
												}) }}</div>
											<div>{{ govukRadios({
													name: "status",
													fieldset: {
														legend: {
															text: "Status"
														}
													},
													items: [
														{
															value: 'checked',
															text: "Not checked"
														},
														{
															value: 'not-checked',
															text: "Checked"
														},
														{
															value: 'ready-to-publish',
															text: "Ready to publish"
														},
														{
															value: 'do-not-publish',
															text: "Do not publish"
														}
													]
												}) }}</div>
											<div>
												{{ govukButton({ text: 'Apply changes' }) }}
												<a href="." class="govuk-link govuk-link--no-visited-state">Clear selected</a>
											</div>
										</div>
									</div>
								</div>
								<div class="govuk-grid-column-one-third">
									<div class="pins-files-list__actions">
										<p class="govuk-heading-s">Document actions</p>
										<a href="1" class="govuk-link">Download selected</a>
										<a href="2" class="govuk-link">Edit properties</a>
										<a href="3" class="govuk-link">Publish selected</a>
										<a href="4" class="govuk-link">Unpublish selected</a>
										<a href="5" class="govuk-link">Move selected</a>
									</div>
								</div>
							</div>

							<div class="pins-files-list__info govuk-body">
								<p class="govuk-heading-s">Select documents to make changes to statuses</p>
								<div class="pagination-info">
									<p>This folder contains {{ documentationFiles.itemCount }} document(s).
										Showing {{ (documentationFiles.page * documentationFiles.pageSize) + 1 }}
										- {{ (documentationFiles.page * documentationFiles.pageSize) +  documentationFiles.items.length }}
										document(s).</p>
									<div>
										{{ govukSelect({
											id: "pageSize",
											name: "pageSize",
											label: {
												text: "View"
											},
											items: pagination.dropdownItems
										}) }}
									</div>
								</div>
								<p>
									<span id="selectedFilesNumber">0</span> document(s) selected
								</p>
							</div>

							<table class="govuk-table pins-files-list__table pins-table">
								<thead class="govuk-table__head govuk-body-s">
								<tr class="govuk-table__row">
									<th scope="col" class="govuk-table__header">Select</th>
									<th scope="col" class="govuk-table__header">Document information</th>
									<th scope="col" class="govuk-table__header">Date received</th>
									<th scope="col" class="govuk-table__header">Redaction</th>
									<th scope="col" class="govuk-table__header">Status</th>
									<th scope="col" class="govuk-table__header">Actions</th>
								</tr>
								</thead>
								<tbody class="govuk-table__body govuk-body-s">
								<tr class="govuk-table__row">
									<td class="govuk-table__cell">
										{{ govukCheckboxes({
											name: "selectAll",
											items: [
												{
													value: true,
													text: 'Select all'
												}]
										}) }}
									</td>
									<td class="govuk-table__cell" colspan="5">
										<p>Select all documents on page</p>
									</td>
								</tr>
								{% for documentationFile in documentationFiles.items %}

									<tr class="govuk-table__row">
										<td class="govuk-table__cell">
											{{ govukCheckboxes({
												name: "selectedFilesIds",
												items: [
													{
														value: documentationFile.guid,
														text: documentationFile.documentName
													}]
											}) }}
										</td>
										<td class="govuk-table__cell">
											{# TODO: still uncertain how the API will return the types
											so probably a literal == will need to be changed later #}
											{% if documentationFile.type === 'PDF' or documentationFile.type === 'JPEG' or documentationFile.type === 'JPG' or documentationFile.type === 'PNG' %}
												<a class="govuk-link govuk-body-s govuk-!-font-weight-bold"
												   href="{{ documentationFile.url }}">
													{{ documentationFile.documentName }}
												</a>
											{% else %}
												<p class="govuk-body-s govuk-!-font-weight-bold">
													{{ documentationFile.documentName }}
												</p>
											{% endif %}
											<p class="file-info colour--secondary">
												From: {{ documentationFile.from }}
											</p>
											<p class="file-info colour--secondary">
												File type and size: {{ documentationFile.type }},
												{{ documentationFile.size|fileSize }}
											</p>
										</td>
										<td class="govuk-table__cell">{{ documentationFile.date|datestamp({format: 'dd/MM/yyyy'}) }}</td>
										<td class="govuk-table__cell">{{ 'Redacted' if  documentationFile.isRedacted else 'Unredacted' }}</td>
										<td class="govuk-table__cell">{{ documentStatusName(documentationFile.status) }}</td>
										<td class="govuk-table__cell">
											<a class="govuk-link govuk-body-s" href="{{ documentationFile.url }}/edit">View/Edit
												properties</a>
											<a class="govuk-link govuk-body-s" href="{{ documentationFile.url }}">Download</a>
										</td>
									</tr>
								{% endfor %}
								</tbody>
							</table>
							{{ govukPagination(pagination.buttons) }}
						</form>
					{% else %}
						This folder contains no documents
					{% endif %}
				{% endif %}
			{% endblock %}
		</div>
	</div>
{% endblock %}

{# TODO: this should be a filter but the actual values
returned by the API are still uncertain and potentially
none of this would be useful #}
{% macro documentStatusName(status) %}
	{% set statusName = '' %}

	{% switch (status) %}
	{% case 'checked' %}
		{% set statusName = 'Checked' %}
	{% case 'unchecked' %}
		{% set statusName = 'Unchecked' %}
	{% case 'ready-to-publish' %}
		{% set statusName = 'Ready to publish' %}
	{% case 'do-not-publish' %}
		{% set statusName = 'Do not publish' %}
	{% endswitch %}

	{{ statusName }}
{% endmacro %}

