{% extends "../layouts/applications.layout.njk" %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% block beforeContent %}
    {{ govukBackLink({
		text: "Back",
		href: breadcrumbItems[breadcrumbItems.length - 1].href
	}) }}
{% endblock %}
{% block pageHeading %}{% endblock %}
{% block pageContent %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full pins-dashboard-list--hide-controls govuk-!-margin-top-0">
            {% block sectionContent %}
                {{ govukBreadcrumbs({
					classes: 'govuk-!-margin-top-0',
					items: breadcrumbItems
				}) }}
                <h1 class="govuk-heading-xl govuk-!-margin-top-4">
                    <span class="govuk-caption-xl">Document properties</span>
                    {{ documentationFile.fileName }}
                </h1>
                <ul class="govuk-list">
                    <li class="govuk-!-margin-top-4"><strong>Description:</strong> {{ documentationFile.description }}</li>
                    <li class="govuk-!-margin-top-4"><strong>Case reference:</strong> {{ case.reference }}</li>
                    <li class="govuk-!-margin-top-4"><strong>Document reference number:</strong></li>
                    <li class="govuk-!-margin-top-4"><strong>File type and size:</strong>
                        {{ documentationFile.mime|fileType }},
                        {{ documentationFile.size|fileSize }}
                    </li>
					<li class="govuk-!-margin-top-4"><strong>Version:</strong> {{ documentationFile.version }}</li>
                </ul>
                <div class="display--flex govuk-!-margin-top-7 govuk-!-margin-bottom-7">
                    <a class="govuk-button govuk-!-margin-0" href="{{ 'document'|url({caseId: caseId, folderId: folderId, documentGuid: documentationFile.documentGuid, step: 'new-version'}) }}">
                        Upload new version
                    </a>
                </div>
                <nav>
					<h4 class="govuk-heading-m govuk-!-margin-bottom-4">Document actions</h4>
                    <a class="govuk-button govuk-button--secondary govuk-!-margin-0" href="/open">Open</a>
					<a class="govuk-button govuk-button--secondary govuk-!-margin-0 govuk-!-margin-left-2" href="{{ 'document-download'|url({caseId: caseId, documentGuid: documentationFile.documentGuid}) }}">Download</a>
                    <a class="govuk-button govuk-button--secondary govuk-!-margin-0 govuk-!-margin-left-2" href="/move">Move</a>
                    <a class="govuk-button govuk-button--secondary govuk-!-margin-0 govuk-!-margin-left-2" href="{{ 'document'|url({caseId: caseId, folderId: folderId, documentGuid: documentationFile.documentGuid, step: 'delete'}) }}">Delete</a>
                </nav>
                <div class="govuk-!-margin-top-7">
                    {% set properties = [
						{label: 'File name', value: documentationFile.fileName, link: 'name'},
						{label: 'Description', value: documentationFile.description, link: 'description'},
						{label: 'From', value: documentationFile.author, link: 'author'},
						{label: 'Agent (optional)', value: documentationFile.representative, link: 'agent'},
						{label: 'Case stage', value: documentationFile.stage},
						{label: 'Webfilter', value: documentationFile.filter1, link: 'webfilter'},
						{label: 'Document type (optional)', value: documentationFile.documentType, link: 'type'},
						{label: 'Date received', value: (documentationFile.dateCreated|datestamp({format: 'dd/MM/yyyy'})), link: 'receipt-date'},
						{label: 'Published date', value: (documentationFile.datePublished|datestamp({format: 'dd/MM/yyyy'})), link: 'published-date' if documentationFile.datePublished else null},
						{label: 'Redaction', value: ('Redacted' if documentationFile.redactedStatus === 'redacted' else 'Unredacted') , link: 'redaction'},
						{label: 'Status', value: documentationFile.publishedStatus|statusName }
					] %}

                    {% set propertiesRow = [] %}
                    {% for property in properties %}
                        {% set row = {
							key: { text: property.label },
							value: { text: property.value },
							actions: { items: [{
								href: ('document-edit'|url({caseId: caseId, folderId: folderId, documentGuid: documentationFile.documentGuid, step: property.link})),
								text: "Change",
								visuallyHiddenText: property.label
							} if property.link else {}]}
						} %}
                        {% set propertiesRow = propertiesRow.concat([row]) %}
                    {% endfor %}
                    {% set documentPropertiesTabHtml %}
                        <h4 class="govuk-heading-m govuk-!-margin-bottom-4">Document properties</h4>
                        {{ govukSummaryList({
                                rows: propertiesRow
                            }) }}
                    {% endset %}
                    {% set documentHistoryTabHtml %}
                        <h4 class="govuk-heading-m govuk-!-margin-bottom-4">Document history</h4>
                        {{ govukTable({
                                captionClasses: "govuk-table__caption--m",
                                head: [
                                    { text: "Version" },
                                    { text: "File name" },
                                    { text: "Activity" },
                                    { text: "Redaction" }
                                ],
                                rows: documentVersionsRows
                            }) }}
                    {% endset %}
                    {{ govukTabs({
						items: [
							{
								label: "Document properties",
								id: "document-properties",
								panel: { html: documentPropertiesTabHtml}
							},
							{
								label: "Document history",
								id: "document-history",
								panel: {html: documentHistoryTabHtml}
							}
						]
					}) }}
                </div>
            {% endblock %}
        </div>
    </div>
{% endblock %}
