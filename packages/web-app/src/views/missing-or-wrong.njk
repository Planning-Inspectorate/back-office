{% extends "layouts/form.njk" %}

{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "components/button-group.njk" import buttonGroup %}
{% from "govuk/components/input/macro.njk" import govukInput %}

{% set reasonsError = errors['missing-or-wrong-reasons'].msg %}
{% set documentsError = errors['missing-or-wrong-documents'].msg %}
{% set otherError = errors['other-reason'].msg %}

{% set noApplicationFormChecked = missingOrWrong.documentReasons and missingOrWrong.documentReasons.includes and missingOrWrong.documentReasons.includes('1') %}
{% set noDecisionNoticeChecked = missingOrWrong.documentReasons and missingOrWrong.documentReasons.includes and missingOrWrong.documentReasons.includes('2') %}
{% set noGroundsOfAppealChecked = missingOrWrong.documentReasons and missingOrWrong.documentReasons.includes and missingOrWrong.documentReasons.includes('3') %}
{% set noSupportingDocumentsChecked = missingOrWrong.documentReasons and missingOrWrong.documentReasons.includes and missingOrWrong.documentReasons.includes('4') %}
{% set namesNotMatchChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('1') %}
{% set sensitiveInformationIncludedChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('2') %}
{% set missingOrWrongDocumentsChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('3') %}
{% set inflammatoryCommentsChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('4') %}
{% set openedInErrorChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('5') %}
{% set wrongAppealTypeChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('6') %}
{% set otherChecked = missingOrWrong.reasons and missingOrWrong.reasons.includes and missingOrWrong.reasons.includes('7') %}

{% block formContent %}
  <p class="govuk-body">Appeal reference: {{appealReference}}</p>

  {% set otherHtml %}
    {{ govukInput({
      id: "other-reason",
      name: "other-reason",
      value: missingOrWrong.otherReason,
      label: {
        text: "List reasons"
      },
      errorMessage: otherError and {
        text: otherError
      }
    }) }}
  {% endset -%}

  {% set missingOrWrongDocumentsHtml %}
    {{ govukCheckboxes({
      idPrefix: "missing-or-wrong-documents",
      name: "missing-or-wrong-documents",
      errorMessage: documentsError and {
        text: documentsError
      },
      items: [
        {
          value: "1",
          text: labels.missingOrWrongDocuments[1],
          checked: noApplicationFormChecked
        },
        {
          value: "2",
          text: labels.missingOrWrongDocuments[2],
          checked: noDecisionNoticeChecked
        },
        {
          value: "3",
          text: labels.missingOrWrongDocuments[3],
          checked: noGroundsOfAppealChecked
        },
        {
          value: "4",
          text: labels.missingOrWrongDocuments[4],
          checked: noSupportingDocumentsChecked
        }
      ]
    }) }}
  {% endset -%}

  {{ govukCheckboxes({
    idPrefix: "missing-or-wrong-reasons",
    name: "missing-or-wrong-reasons",
    errorMessage: reasonsError and {
      text: reasonsError
    },
    items: [
      {
        value: "1",
        text: labels.missingOrWrongReasons[1],
        checked: namesNotMatchChecked
      },
      {
        value: "2",
        text: labels.missingOrWrongReasons[2],
        checked: sensitiveInformationIncludedChecked
      },
      {
        value: "3",
        text: labels.missingOrWrongReasons[3],
        checked: missingOrWrongDocumentsChecked,
        conditional: {
          html: missingOrWrongDocumentsHtml
        }
      },
      {
        value: "4",
        text: labels.missingOrWrongReasons[4],
        checked: inflammatoryCommentsChecked
      },
      {
        value: "5",
        text: labels.missingOrWrongReasons[5],
        checked: openedInErrorChecked
      },
      {
        value: "6",
        text: labels.missingOrWrongReasons[6],
        checked: wrongAppealTypeChecked
      },
      {
        value: "7",
        text: labels.missingOrWrongReasons[7],
        checked: otherChecked,
        conditional: {
          html: otherHtml
        }
      }
    ]
  }) }}

  {{ buttonGroup(backLink) }}
{% endblock %}
