{% extends "layouts/main.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "components/address.njk" import address %}

{% set questionnairesListDisplayData = [] %}

{% for questionnaire in sortedQuestionnairesData %}
  {% if questionnaire.questionnaireStatus === "Received" %}
    {% set reference = "<a class='govuk-link' href=\"review-questionnaire-submission/" + questionnaire.appealId + "\">" + questionnaire.caseReference + "</a>"%}
  {% else %}
    {% set reference = questionnaire.caseReference %}
  {% endif %}

  {% set status %}
    <strong class="govuk-tag govuk-tag--{{ questionnaire.questionnaireStatusColour }}">
      {{ questionnaire.questionnaireStatus }}
    </strong>
  {% endset %}

  {% set questionnairesListDisplayData = (questionnairesListDisplayData.push([
    { html: reference},
    { text: questionnaire.submissionDate | date },
    { text: address({
      addressLine1: questionnaire.siteAddressLineOne,
      addressLine2: questionnaire.siteAddressLineTwo,
      town: questionnaire.siteAddressTown,
      county: questionnaire.siteAddressCounty,
      postcode: questionnaire.siteAddressPostCode
    }, true) },
    { html: status, classes: 'govuk-table__cell govuk-table__cell--numeric' }
  ]), questionnairesListDisplayData) %}
{% endfor %}

{% block backButton %}
{% endblock %}

{% block content %}
  <h1 class="govuk-heading-xl">{{ pageTitle }}</h1>

  {{ govukTable({
    head: [
      { text: "Appeal reference" },
      { text: "Due date" },
      { text: "Appeal site" },
      { text: "Status" }
    ],
    rows: questionnairesListDisplayData
  }) }}
{% endblock %}
