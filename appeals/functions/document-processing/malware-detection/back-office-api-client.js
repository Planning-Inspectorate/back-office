import got from 'got';
import config from './config.js';
/**
 * @param {*} info
 * @param {*} status
 * @param {*} context
 * @returns {Promise<{id: string | null}>}
 */
async function patch(info, status, context) {
	try {
		const version = info.version.replace('v', '');
		const payload = {
			documents: [
				{
					id: info.id,
					version: Number(version),
					virusCheckStatus: status
				}
			]
		};

		context.log.info(`Patching document: ${payload}`);
		const result = await got
			.patch(`https://${config.API_HOST}/appeals/documents/avcheck`, {
				json: payload
			})
			.json();

		return result;
	} catch (err) {
		throw new Error(`patching document AV scan failed with error: ${err}`);
	}
}

export default {
	patch
};
