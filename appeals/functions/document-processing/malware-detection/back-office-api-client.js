import got from 'got';
import config from './config.js';
/**
 * @param {*} info
 * @param {*} status
 * @param {*} context
 * @returns {Promise<{id: string | null}>}
 */
async function patch(info, status, context) {
	try {
		const payload = {
			documents: [
				{
					id: info.id,
					version: Number(info.version),
					virusCheckStatus: status
				}
			]
		};

		context.log.info(`Patching document: ${JSON.stringify(payload)}`);

		const systemUserId = '00000000-0000-0000-0000-000000000000';
		const result = await got
			.patch(`https://${config.API_HOST}/appeals/documents/avcheck`, {
				json: payload,
				headers: { azureAdUserId: systemUserId }
			})
			.json();

		return result.documents[0];
	} catch (err) {
		throw new Error(`patching document AV scan failed with error: ${err}`);
	}
}

export default {
	patch
};
